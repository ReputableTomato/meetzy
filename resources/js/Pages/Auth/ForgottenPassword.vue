<template>
    <DarkModeHeader />

    <div class="default_area">
        <div class="default_wrap">
            <FormTop title="Account Recovery" description="weâ€™ll email you a link so you can reset your password." />

            <form class="default_form login bg-white" @submit.prevent="resetPassword">
                <Alerts />

                <div class="form_group mb_20">
                    <label for="email" class="text_blue text_sm pb_8">Email</label>
                    <input type="text" class="input_grey pt_12 pb_12 pl_15 pr_15 round12 greybg w-100" placeholder="Enter your email" v-model="forgottenPasswordForm.email">
                </div>
                <div class="form_group mb_20">
                    <label for="date_of_birth" class="text_blue text_sm pb_8">Date of Birth</label>
                    <Datepicker id="date_of_birth" class="input_grey pt_12 pb_12 pl_15 pr_15 round12 greybg w-100" placeholder="Select your date of birth"  v-model="forgottenPasswordForm.date_of_birth" starting-view="year"></Datepicker>
                </div>

                <button type="submit" class="blue_button w-100">Reset Password</button>
            </form>

            <p class="text-center text_sm f_500 mt_32 text_form_bottom">
                <span class="text_bodyColor50">Already have an account? </span>
                <Link href="/login" class="site_icon text_blue">Log in</Link>
            </p>
        </div>
    </div>
</template>

<script>
import { Link } from '@inertiajs/vue3'
import Datepicker from 'vue3-datepicker'
import DarkModeHeader from "../../Shared/Auth/DarkModeHeader.vue";
import Alerts from "../../Shared/Auth/Alerts.vue";
import FormTop from "../../Shared/Auth/FormTop.vue";

export default {
    components: {
        DarkModeHeader,
        Alerts,
        FormTop,
        Link,
        Datepicker
    },
    data() {
        return {
            keepMeLoggedIn: false,
            forgottenPasswordForm: this.$inertia.form({
                email: 'test@test.com',
                date_of_birth: null,
            })
        }
    },
    methods: {
        resetPassword() {
            this.forgottenPasswordForm
                .transform((data) => {
                    return {
                        ...data,
                        date_of_birth: data.date_of_birth ? this.extractDate(data.date_of_birth) : null
                    }
                })
                .post('/forgotten-password');
        },
        extractDate(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }
    }
};
</script>
